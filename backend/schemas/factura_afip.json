{
  "category": "financieros",
  "type": "object",
  "title": "Factura Electrónica AFIP",
  "description": "Factura electrónica para emisión en AFIP con validación y CAE automático",
  "properties": {
    "emisor_cuit": {
      "type": "cuit",
      "description": "CUIT de tu empresa (11 dígitos o con guiones). El sistema buscará el certificado AFIP correspondiente."
    },
    "emisor_razon_social": {
      "type": "string",
      "description": "Razón Social del emisor (se consulta automáticamente desde AFIP si no se proporciona)"
    },
    "emisor_domicilio": {
      "type": "string",
      "description": "Domicilio comercial del emisor (si no se proporciona, se usa el domicilio fiscal de AFIP)"
    },
    "emisor_domicilio_comercial": {
      "type": "string",
      "description": "Alias para domicilio comercial del emisor"
    },
    "emisor_condicion_iva": {
      "type": "string",
      "description": "Condición frente al IVA del emisor (se valida con AFIP si se proporciona)",
      "enum": [
        "RESPONSABLE_INSCRIPTO",
        "MONOTRIBUTO",
        "EXENTO",
        "CONSUMIDOR_FINAL",
        "NO_CATEGORIZADO",
        "PROVEEDOR_EXTERIOR",
        "CLIENTE_EXTERIOR",
        "IVA_LIBERADO",
        "MONOTRIBUTISTA_SOCIAL",
        "NO_ALCANZADO"
      ]
    },
    "emisor_iibb": {
      "type": "string",
      "description": "Situación frente a Ingresos Brutos del emisor (se infiere desde AFIP si no se proporciona)"
    },
    "emisor_fecha_inicio_actividades": {
      "type": "date",
      "description": "Fecha de inicio de actividades del emisor (se extrae desde AFIP si no se proporciona)"
    },
    "emisor_inicio_actividades": {
      "type": "date",
      "description": "Alias para fecha de inicio de actividades del emisor"
    },
    "tipo_comprobante": {
      "type": "string",
      "description": "Tipo de Comprobante",
      "enum": [
        "FACTURA_A",
        "FACTURA_B",
        "FACTURA_C",
        "NOTA_CREDITO_A",
        "NOTA_CREDITO_B",
        "NOTA_CREDITO_C",
        "NOTA_DEBITO_A",
        "NOTA_DEBITO_B",
        "NOTA_DEBITO_C"
      ],
      "enumLabels": [
        "Factura A",
        "Factura B",
        "Factura C",
        "Nota de Crédito A",
        "Nota de Crédito B",
        "Nota de Crédito C",
        "Nota de Débito A",
        "Nota de Débito B",
        "Nota de Débito C"
      ]
    },
    "letra_comprobante": {
      "type": "string",
      "description": "Letra del Comprobante",
      "enum": ["A", "B", "C"]
    },
    "concepto_comprobante": {
      "type": "integer",
      "description": "Concepto",
      "enum": [1, 2, 3],
      "enumLabels": ["1 - Productos", "2 - Servicios", "3 - Productos y Servicios"],
      "default": 1
    },
    "fecha_comprobante": {
      "type": "date",
      "description": "Fecha de emisión del comprobante"
    },
    "fecha_servicio_desde": {
      "type": "date",
      "description": "Fecha Servicio Desde (obligatorio para servicios)"
    },
    "fecha_servicio_hasta": {
      "type": "date",
      "description": "Fecha Servicio Hasta (obligatorio para servicios)"
    },
    "fecha_vto_pago": {
      "type": "date",
      "description": "Fecha Vencimiento de Pago (obligatorio para servicios)"
    },
    "cliente": {
      "type": "object",
      "description": "Datos del cliente / receptor",
      "properties": {
        "razon_social": {
          "type": "string",
          "description": "Razón Social / Nombre del cliente"
        },
        "domicilio": {
          "type": "string",
          "description": "Domicilio del cliente"
        },
        "cuit": {
          "type": "cuit",
          "description": "CUIT del cliente (solo si es Responsable Inscripto)"
        },
        "dni": {
          "type": "string",
          "description": "DNI del cliente (solo si es Consumidor Final)",
          "pattern": "^\\d{7,8}$"
        },
        "cuil": {
          "type": "string",
          "description": "CUIL del cliente",
          "pattern": "^\\d{11}$|^\\d{2}-\\d{8}-\\d$"
        },
        "otro_tipo": {
          "type": "integer",
          "description": "Otro tipo de documento (CDI, etc.)",
          "enum": [87, 99],
          "enumLabels": ["87 - CDI", "99 - Sin Identificar"]
        },
        "otro_numero": {
          "type": "string",
          "description": "Número del otro documento"
        },
        "condicion_iva": {
          "type": "string",
          "description": "Condición ante IVA",
          "enum": [
            "RESPONSABLE_INSCRIPTO",
            "MONOTRIBUTO",
            "EXENTO",
            "CONSUMIDOR_FINAL",
            "NO_CATEGORIZADO",
            "PROVEEDOR_EXTERIOR",
            "CLIENTE_EXTERIOR",
            "IVA_LIBERADO",
            "MONOTRIBUTISTA_SOCIAL",
            "NO_ALCANZADO"
          ]
        }
      },
      "required": ["razon_social", "domicilio", "condicion_iva"]
    },
    "items": {
      "type": "array",
      "description": "Items / Líneas de Factura",
      "minItems": 1,
      "items": {
        "type": "object",
        "properties": {
          "descripcion": {
            "type": "string",
            "description": "Descripción detallada del producto o servicio"
          },
          "cantidad": {
            "type": "number",
            "description": "Cantidad de unidades",
            "minimum": 0.01
          },
          "precio_unitario": {
            "type": "number",
            "description": "Precio unitario SIN IVA",
            "minimum": 0
          },
          "iva": {
            "type": "number",
            "description": "Alícuota IVA (%)",
            "enum": [0, 2.5, 5, 10.5, 21, 27],
            "enumLabels": ["0% - No gravado", "2.5%", "5%", "10.5%", "21% - General", "27%"]
          },
          "subtotal": {
            "type": "number",
            "description": "Subtotal del item (cantidad × precio)"
          }
        },
        "required": ["descripcion", "cantidad", "precio_unitario", "iva"]
      }
    },
    "subtotal": {
      "type": "number",
      "description": "Subtotal (sin IVA)",
      "minimum": 0
    },
    "iva_total": {
      "type": "number",
      "description": "IVA Total",
      "minimum": 0
    },
    "total": {
      "type": "number",
      "description": "Total con IVA",
      "minimum": 0
    },
    "observaciones": {
      "type": "string",
      "description": "Notas u observaciones adicionales (opcional)"
    },
    "codigo_moneda": {
      "type": "string",
      "description": "Código de moneda (PES, DOL, EUR, etc.). Por defecto PES. Consultar FEParamGetTiposMonedas para códigos válidos.",
      "default": "PES"
    },
    "codigoMoneda": {
      "type": "string",
      "description": "Alias para código de moneda"
    },
    "cotizacion_moneda": {
      "type": "number",
      "description": "Cotización de la moneda extranjera. Para PES debe ser 1. Para otras monedas, se consulta automáticamente desde AFIP si no se proporciona.",
      "minimum": 0
    },
    "cotizacionMoneda": {
      "type": "number",
      "description": "Alias para cotización de moneda"
    },
    "tipo_cambio": {
      "type": "number",
      "description": "Alias para cotización de moneda"
    },
    "can_mis_mon_ext": {
      "type": "string",
      "description": "Si se cancela en misma moneda extranjera. Valores: 'S' o 'N'. Si MonId=PES, debe ser 'N' o no informarse.",
      "enum": ["S", "N"]
    },
    "canMisMonExt": {
      "type": "string",
      "description": "Alias para can_mis_mon_ext"
    },
    "documento_asociado": {
      "type": "object",
      "description": "Documento asociado (para notas de crédito/débito)",
      "properties": {
        "tipo_comprobante": {
          "type": "integer",
          "description": "Tipo de comprobante asociado"
        },
        "punto_venta": {
          "type": "integer",
          "description": "Punto de venta del comprobante asociado"
        },
        "numero_comprobante": {
          "type": "integer",
          "description": "Número de comprobante asociado"
        },
        "cuit": {
          "type": "cuit",
          "description": "CUIT emisor del comprobante asociado (opcional)"
        },
        "fecha_comprobante": {
          "type": "date",
          "description": "Fecha del comprobante asociado (opcional)"
        }
      }
    },
    "documentoAsociado": {
      "type": "object",
      "description": "Alias para documento_asociado"
    },
    "comprobantes_asociados": {
      "type": "array",
      "description": "Array de comprobantes asociados (para notas de crédito/débito con múltiples documentos)",
      "items": {
        "type": "object",
        "properties": {
          "tipo_comprobante": {
            "type": "integer",
            "description": "Tipo de comprobante asociado"
          },
          "punto_venta": {
            "type": "integer",
            "description": "Punto de venta del comprobante asociado"
          },
          "numero_comprobante": {
            "type": "integer",
            "description": "Número de comprobante asociado"
          },
          "cuit": {
            "type": "cuit",
            "description": "CUIT emisor del comprobante asociado (opcional)"
          },
          "fecha_comprobante": {
            "type": "date",
            "description": "Fecha del comprobante asociado (opcional)"
          }
        }
      }
    },
    "comprobantesAsociados": {
      "type": "array",
      "description": "Alias para comprobantes_asociados"
    },
    "cae": {
      "type": "cae",
      "description": "CAE (Código de Autorización) - Se completa automáticamente al emitir en AFIP"
    },
    "cae_vencimiento": {
      "type": "date",
      "description": "CAE - Fecha de Vencimiento - Se completa automáticamente al emitir en AFIP"
    },
    "punto_venta": {
      "type": "number",
      "description": "Punto de Venta - Se asigna automáticamente desde la configuración"
    },
    "numero_comprobante": {
      "type": "number",
      "description": "Número de Comprobante - Se asigna automáticamente por AFIP"
    },
    "estado_afip": {
      "type": "string",
      "description": "Estado en AFIP",
      "enum": ["pendiente", "aprobado", "rechazado", "error"]
    },
    "pdf_url": {
      "type": "string",
      "description": "URL del PDF generado automáticamente"
    }
  },
  "required": [
    "emisor_cuit",
    "tipo_comprobante",
    "letra_comprobante",
    "concepto_comprobante",
    "fecha_comprobante",
    "cliente",
    "items",
    "subtotal",
    "iva_total",
    "total"
  ],
  "additionalProperties": false
}
